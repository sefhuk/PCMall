<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>User Orders</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    th {
      background-color: #f2f2f2;
    }
  </style>
</head>
<body>
  <div class="container mt-5">
    <h1>주문 목록</h1>
    <table class="table">
      <thead>
      <tr>
        <th>주문번호</th>
        <th>상태</th>
        <th>가격</th>
<!--        <th>Action</th>-->
      </tr>
      </thead>
      <tbody>
      <tr th:each="order : ${orders}">
        <td th:text="${order.id}"></td>
        <td th:text="${order.status.getStatus()}"></td>
        <td th:text="${order.totalPrice}"></td>
        <td>
          <!-- Show Details 버튼에 클릭 이벤트 추가 -->
          <button class="btn btn-primary me-2" th:onclick="'viewDetails(' + ${order.id} + ')'">상세보기</button>
          <button class="btn btn-danger me-2" th:onclick="'cancelOrder(' + ${order.id} + ')'" th:unless="${order.status.getStatus().equals('취소') || order.status.getStatus().equals('배송 완료')}">취소</button>
          <button class="btn btn-warning" th:unless="${order.status.getStatus().equals('취소') || order.status.getStatus().equals('배송 완료')}">수정</button>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    function viewDetails(orderId) {
      window.location.href = '/order/detail/' + orderId;
    }
    
    const cancelOrder = async (orderId) => {
      const cancelData = { orderStatus: "CANCELED" };
      
      try {
        const updateResult = await fetch(`/api/order/${orderId}`, {
          method: "PUT",
          body: JSON.stringify(cancelData),
          headers: { "Content-Type": "application/json" }
        });
        
        if (updateResult.ok) {
          window.location.reload();
        } else {
          console.error("주문 취소에 실패했습니다.");
        }
      } catch (error) {
        console.error("오류:", error);
      }
    };
  </script>
</body>
</html>



